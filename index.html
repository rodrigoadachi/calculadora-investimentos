<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Investimentos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const InvestmentCalculator = () => {
            const [initialValue, setInitialValue] = useState('');
            const [monthlyValue, setMonthlyValue] = useState('');
            const [reinvestReturns, setReinvestReturns] = useState(false);
            const [investmentType, setInvestmentType] = useState('CDB');
            const [months, setMonths] = useState('12');
            const [cdiRate, setCdiRate] = useState(12.55);
            const [cdbPercentage, setCdbPercentage] = useState('100');
            const [results, setResults] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [cdiLoading, setCdiLoading] = useState(false);

            const formatCurrency = (value) => {
                return value.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL',
                });
            };

            const formatPercentage = (value) => {
                return `${value.toFixed(2)}%`;
            };

            const fetchCdiRate = async () => {
                setCdiLoading(true);
                try {
                    const response = await fetch(
                        'https://api.bcb.gov.br/dados/serie/bcdata.sgs.12/dados/ultimos/1?formato=json'
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data && data.length > 0) {
                            const cdiValue = parseFloat(data[0].valor);
                            setCdiRate(cdiValue);
                        }
                    } else {
                        console.warn('Erro ao buscar CDI, mantendo valor padrão');
                    }
                } catch (error) {
                    console.warn('Erro na API do BCB, mantendo valor padrão:', error);
                } finally {
                    setCdiLoading(false);
                }
            };

            const getIrRate = (months) => {
                if (months <= 6) return 0.225; // 22.5%
                if (months <= 12) return 0.20; // 20%
                if (months <= 24) return 0.175; // 17.5%
                return 0.15; // 15%
            };

            const getIofRate = (days) => {
                if (days <= 30) {
                    const rates = [
                        0.96, 0.93, 0.90, 0.86, 0.83, 0.80, 0.76, 0.73, 0.70, 0.66,
                        0.63, 0.60, 0.56, 0.53, 0.50, 0.46, 0.43, 0.40, 0.36, 0.33,
                        0.30, 0.26, 0.23, 0.20, 0.16, 0.13, 0.10, 0.06, 0.03, 0.00
                    ];
                    return (rates[days - 1] || 0) / 100;
                }
                return 0;
            };

            const calculateInvestment = () => {
                const initial = parseFloat(initialValue) || 0;
                const monthly = parseFloat(monthlyValue) || 0;
                const totalMonths = parseInt(months) || 12;
                const cdbPerc = parseFloat(cdbPercentage) / 100;
                
                const annualRate = (cdiRate * cdbPerc / 100) / 100; // CDI em decimal
                const monthlyRate = Math.pow(1 + annualRate, 1/12) - 1;
                
                const simulationResults = [];
                let totalDeposited = initial;
                let grossBalance = initial;
                let netBalance = initial;

                for (let month = 1; month <= totalMonths; month++) {
                    // Adiciona depósito mensal
                    totalDeposited += monthly;
                    grossBalance += monthly;
                    netBalance += monthly;

                    // Calcula rendimento do saldo atual
                    const grossReturn = grossBalance * monthlyRate;
                    
                    let tax = 0;
                    let netReturn = grossReturn;
                    
                    if (investmentType === 'CDB') {
                        const irRate = getIrRate(month);
                        tax = grossReturn * irRate;
                        
                        // IOF apenas nos primeiros 30 dias
                        if (month === 1) {
                            const iofRate = getIofRate(30);
                            tax += grossReturn * iofRate;
                        }
                        
                        netReturn = grossReturn - tax;
                    }

                    // Aplica reinvestimento
                    if (reinvestReturns) {
                        grossBalance += grossReturn;
                        netBalance += netReturn;
                    } else {
                        grossBalance += grossReturn;
                        netBalance += netReturn;
                    }

                    simulationResults.push({
                        month,
                        monthlyDeposit: monthly,
                        grossReturn,
                        tax,
                        netReturn,
                        accumulatedGross: grossBalance,
                        accumulatedNet: netBalance,
                    });
                }

                setResults(simulationResults);
            };

            const handleCalculate = () => {
                setIsLoading(true);
                setTimeout(() => {
                    calculateInvestment();
                    setIsLoading(false);
                }, 500);
            };

            useEffect(() => {
                fetchCdiRate();
            }, []);

            const totalInvested = parseFloat(initialValue || '0') + (parseFloat(monthlyValue || '0') * parseInt(months || '12'));
            const finalResult = results[results.length - 1];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8">
                    <div className="container mx-auto px-4 max-w-6xl">
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-6">
                                <h1 className="text-3xl font-bold text-white mb-2">
                                    Calculadora de Investimentos
                                </h1>
                                <p className="text-blue-100">
                                    Simule seus investimentos em LCI/LCA e CDB com precisão
                                </p>
                            </div>

                            <div className="p-6">
                                <div className="grid md:grid-cols-2 gap-8">
                                    {/* Formulário */}
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Valor Inicial (R$)
                                            </label>
                                            <input
                                                type="number"
                                                value={initialValue}
                                                onChange={(e) => setInitialValue(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                placeholder="0,00"
                                                min="0"
                                                step="0.01"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Valor Mensal (R$)
                                            </label>
                                            <input
                                                type="number"
                                                value={monthlyValue}
                                                onChange={(e) => setMonthlyValue(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                placeholder="0,00"
                                                min="0"
                                                step="0.01"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Período (meses)
                                            </label>
                                            <input
                                                type="number"
                                                value={months}
                                                onChange={(e) => setMonths(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                min="1"
                                                max="360"
                                            />
                                        </div>

                                        <div className="flex items-center space-x-2">
                                            <input
                                                type="checkbox"
                                                id="reinvest"
                                                checked={reinvestReturns}
                                                onChange={(e) => setReinvestReturns(e.target.checked)}
                                                className="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                            />
                                            <label htmlFor="reinvest" className="text-sm font-medium text-gray-700">
                                                Reinvestir rendimentos
                                            </label>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-3">
                                                Tipo de Investimento
                                            </label>
                                            <div className="space-y-2">
                                                <div className="flex items-center">
                                                    <input
                                                        type="radio"
                                                        id="lci-lca"
                                                        name="investment-type"
                                                        value="LCI_LCA"
                                                        checked={investmentType === 'LCI_LCA'}
                                                        onChange={(e) => setInvestmentType(e.target.value)}
                                                        className="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <label htmlFor="lci-lca" className="ml-2 text-sm text-gray-700">
                                                        LCI/LCA (Isento de IR)
                                                    </label>
                                                </div>
                                                <div className="flex items-center">
                                                    <input
                                                        type="radio"
                                                        id="cdb"
                                                        name="investment-type"
                                                        value="CDB"
                                                        checked={investmentType === 'CDB'}
                                                        onChange={(e) => setInvestmentType(e.target.value)}
                                                        className="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <label htmlFor="cdb" className="ml-2 text-sm text-gray-700">
                                                        CDB (Tributação IR)
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                % do CDI
                                            </label>
                                            <input
                                                type="number"
                                                value={cdbPercentage}
                                                onChange={(e) => setCdbPercentage(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                min="1"
                                                max="200"
                                                step="0.1"
                                            />
                                        </div>

                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="text-sm font-medium text-gray-600">
                                                    CDI Atual:
                                                </span>
                                                <button
                                                    onClick={fetchCdiRate}
                                                    disabled={cdiLoading}
                                                    className="text-blue-600 hover:text-blue-800 text-sm font-medium disabled:opacity-50"
                                                >
                                                    {cdiLoading ? 'Carregando...' : 'Atualizar'}
                                                </button>
                                            </div>
                                            <div className="text-xl font-bold text-gray-800">
                                                {formatPercentage(cdiRate)} a.a.
                                            </div>
                                            <div className="text-sm text-gray-500">
                                                Rentabilidade: {formatPercentage(cdiRate * parseFloat(cdbPercentage || '100') / 100)} a.a.
                                            </div>
                                        </div>

                                        <button
                                            onClick={handleCalculate}
                                            disabled={isLoading || (!initialValue && !monthlyValue) || !months}
                                            className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
                                        >
                                            {isLoading ? 'Calculando...' : 'Calcular Investimento'}
                                        </button>
                                    </div>

                                    {/* Resumo */}
                                    <div className="space-y-6">
                                        <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                                            <h3 className="text-lg font-bold text-gray-800 mb-4">Resumo do Investimento</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Total Investido:</span>
                                                    <span className="font-semibold">{formatCurrency(totalInvested)}</span>
                                                </div>
                                                {finalResult && (
                                                    <>
                                                        <div className="flex justify-between">
                                                            <span className="text-gray-600">Valor Bruto:</span>
                                                            <span className="font-semibold">{formatCurrency(finalResult.accumulatedGross)}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span className="text-gray-600">Impostos:</span>
                                                            <span className="font-semibold text-red-600">
                                                                -{formatCurrency(finalResult.accumulatedGross - finalResult.accumulatedNet)}
                                                            </span>
                                                        </div>
                                                        <div className="flex justify-between border-t pt-3">
                                                            <span className="text-gray-800 font-bold">Valor Líquido:</span>
                                                            <span className="font-bold text-green-600 text-lg">
                                                                {formatCurrency(finalResult.accumulatedNet)}
                                                            </span>
                                                        </div>
                                                        <div className="flex justify-between">
                                    